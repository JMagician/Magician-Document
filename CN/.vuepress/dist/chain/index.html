<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Magician-Blockchain | Magician</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?c99e92fd72d5a319e1864652d6a834f7";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
    <meta name="description" content="一套Java开发的工具包，可以满足区块链 和 Web开发的大部分场景">
    <meta name="keywords" content="Magician,Magician框架,小型服务框架,开源http服务,web开发,Java,开源项目,NIO,区块链开发,Web">
    
    <link rel="preload" href="/cn/assets/css/0.styles.e8732725.css" as="style"><link rel="preload" href="/cn/assets/js/app.ae022c5b.js" as="script"><link rel="preload" href="/cn/assets/js/2.09610e94.js" as="script"><link rel="preload" href="/cn/assets/js/9.07247551.js" as="script"><link rel="prefetch" href="/cn/assets/js/10.d8f7b996.js"><link rel="prefetch" href="/cn/assets/js/11.732f2d43.js"><link rel="prefetch" href="/cn/assets/js/12.ac41a0d2.js"><link rel="prefetch" href="/cn/assets/js/13.a2b0619c.js"><link rel="prefetch" href="/cn/assets/js/3.d341c646.js"><link rel="prefetch" href="/cn/assets/js/4.b7b73457.js"><link rel="prefetch" href="/cn/assets/js/5.136e2504.js"><link rel="prefetch" href="/cn/assets/js/6.a9aa8f92.js"><link rel="prefetch" href="/cn/assets/js/7.d6b6698a.js"><link rel="prefetch" href="/cn/assets/js/8.b94fe1f2.js">
    <link rel="stylesheet" href="/cn/assets/css/0.styles.e8732725.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cn/" class="home-link router-link-active"><!----> <span class="site-name">Magician</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Github" class="dropdown-title"><span class="title">Github</span> <span class="arrow down"></span></button> <button type="button" aria-label="Github" class="mobile-dropdown-title"><span class="title">Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Magician-Blockchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  区块链
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/JMagician" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Web
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JMagician/Magician/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  社区
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cn/chain/index.html" class="nav-link">
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/cn/web/index.html" class="nav-link">
  Magician
</a></li><li class="dropdown-item"><!----> <a href="/cn/db/index.html" class="nav-link">
  Magician-JDBC
</a></li><li class="dropdown-item"><!----> <a href="/cn/web/magician-web.html" class="nav-link">
  Magician-Web
</a></li></ul></div></div><div class="nav-item"><a href="/cn/sponsor/sponsor.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="社交平台" class="dropdown-title"><span class="title">社交平台</span> <span class="arrow down"></span></button> <button type="button" aria-label="社交平台" class="mobile-dropdown-title"><span class="title">社交平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://t.me/magicianio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5453518101" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博(@Magician开源)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/cn/business/business.html" class="nav-link">
  商业合作
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://magician-io.com/cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简体中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://magician-io.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  English
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Github" class="dropdown-title"><span class="title">Github</span> <span class="arrow down"></span></button> <button type="button" aria-label="Github" class="mobile-dropdown-title"><span class="title">Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Magician-Blockchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  区块链
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/JMagician" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Web
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JMagician/Magician/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  社区
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cn/chain/index.html" class="nav-link">
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/cn/web/index.html" class="nav-link">
  Magician
</a></li><li class="dropdown-item"><!----> <a href="/cn/db/index.html" class="nav-link">
  Magician-JDBC
</a></li><li class="dropdown-item"><!----> <a href="/cn/web/magician-web.html" class="nav-link">
  Magician-Web
</a></li></ul></div></div><div class="nav-item"><a href="/cn/sponsor/sponsor.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="社交平台" class="dropdown-title"><span class="title">社交平台</span> <span class="arrow down"></span></button> <button type="button" aria-label="社交平台" class="mobile-dropdown-title"><span class="title">社交平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://t.me/magicianio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5453518101" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博(@Magician开源)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/cn/business/business.html" class="nav-link">
  商业合作
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://magician-io.com/cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简体中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://magician-io.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  English
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Magician-Blockchain</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cn/chain/#magician-scanning" class="sidebar-link">Magician-Scanning</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/chain/#导入依赖" class="sidebar-link">导入依赖</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#eth-bsc-poygan-等-链" class="sidebar-link">ETH(BSC, POYGAN 等)链</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#tron链" class="sidebar-link">TRON链</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#solana链" class="sidebar-link">SOLANA链</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#停止某一个扫块任务" class="sidebar-link">停止某一个扫块任务</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#配置多个rpc-url-实现负载均衡" class="sidebar-link">配置多个RPC URL 实现负载均衡</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#重试策略-三条链都是一样的写法" class="sidebar-link">重试策略（三条链都是一样的写法）</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#inputdata-编解码" class="sidebar-link">InputData 编解码</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#项目内置了几个functioncode-eth专用" class="sidebar-link">项目内置了几个functionCode（ETH专用）</a></li></ul></li><li><a href="/cn/chain/#magician-contractstools" class="sidebar-link">Magician-ContractsTools</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/chain/#导入依赖-2" class="sidebar-link">导入依赖</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#合约查询-以及-写入" class="sidebar-link">合约查询 以及 写入</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#合约模板" class="sidebar-link">合约模板</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#inputdata-编解码-2" class="sidebar-link">InputData 编解码</a></li><li class="sidebar-sub-header"><a href="/cn/chain/#主链币查询以及转账" class="sidebar-link">主链币查询以及转账</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="magician-blockchain"><a href="#magician-blockchain" class="header-anchor">#</a> Magician-Blockchain</h1> <h2 id="magician-scanning"><a href="#magician-scanning" class="header-anchor">#</a> Magician-Scanning</h2> <p>Magician-Scanning是一个用Java开发的扫描区块链的工具包，当我们在程序中需要一些功能时，它可以派上用场，比如说。</p> <ul><li><p>当一个地址收到ETH时，程序中的一个方法会被自动触发，这个交易会被传入该方法。</p></li> <li><p>当一个合约的某个功能被调用时（比如ERC20转账），它会自动触发程序中的一个方法，并将这个交易传递给这个方法。它甚至可以只在代币被转移到指定地址时被触发。</p></li> <li><p>当程序需要保留一个区块高度开始以来的所有交易记录时，也可以使用这个工具包。</p></li></ul> <p>它计划支持三种链，ETH（BSC，POLYGON等），SOL和TRON</p> <h3 id="导入依赖"><a href="#导入依赖" class="header-anchor">#</a> 导入依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.yuyenews<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Magician-Scanning<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- This is the logging package, you must have it or the console will not see anything, any logging package that can bridge with slf4j is supported --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-jdk14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="eth-bsc-poygan-等-链"><a href="#eth-bsc-poygan-等-链" class="header-anchor">#</a> ETH(BSC, POYGAN 等)链</h3> <h4 id="创建监听器"><a href="#创建监听器" class="header-anchor">#</a> 创建监听器</h4> <p>监听器 可以创建多个，根据你的需求 分别设置监听条件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 创建一个类，实现 EthMonitorEvent接口 即可
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventDemo</span> <span class="token keyword">implements</span> <span class="token class-name">EthMonitorEvent</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 筛选条件，如果遇到了符合条件的交易，会自动触发 call方法
     * 这些条件都是 并且的关系，必须要同时满足才行
     * 如果不想根据某个条件筛选，直接不给那个条件设置值就好了
     * 这个方法如果不实现，或者返回null， 那么就代表监听任意交易
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">EthMonitorFilter</span> <span class="token function">ethMonitorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">EthMonitorFilter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setFromAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x131231249813d334C58f2757037F68E2963C4crc&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 筛选 fromAddress 发送的交易</span>
                <span class="token punctuation">.</span><span class="token function">setToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 筛选 toAddress 或 合约地址 收到的交易</span>
                <span class="token punctuation">.</span><span class="token function">setMinValue</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 筛选发送的主链币数量 &gt;= minValue 的交易</span>
                <span class="token punctuation">.</span><span class="token function">setMaxValue</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 筛选发送的主链币数量 &lt;= maxValue 的交易</span>
                <span class="token punctuation">.</span><span class="token function">setInputDataFilter</span><span class="token punctuation">(</span> <span class="token comment">// 根据inputData筛选</span>
                        <span class="token class-name">InputDataFilter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setFunctionCode</span><span class="token punctuation">(</span>ERC20<span class="token punctuation">.</span>TRANSFER<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 函数签名（被调用的合约内的某方法）, 支持任意函数，这里的枚举只是一部分标准的合约函数</span>
                                <span class="token punctuation">.</span><span class="token function">setTypeReferences</span><span class="token punctuation">(</span> <span class="token comment">// 此方法的参数列表（仅类型）</span>
                                        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Uint256</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
                                <span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">// 筛选第几个参数 = 什么值</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 如果遇到了符合上面条件的交易，就会触发这个方法
     * transactionModel.getEthTransactionModel() 是一个交易对象，内部包含hash，value，from，to 等 所有的数据
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">TransactionModel</span> transactionModel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> template <span class="token operator">=</span> <span class="token string">&quot;EventOne 扫描到了, hash:{0}, from:{1}, to: {2}, input: {3}&quot;</span><span class="token punctuation">;</span>
        template <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> transactionModel<span class="token punctuation">.</span><span class="token function">getEthTransactionModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBlockHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{1}&quot;</span><span class="token punctuation">,</span> transactionModel<span class="token punctuation">.</span><span class="token function">getEthTransactionModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{2}&quot;</span><span class="token punctuation">,</span> transactionModel<span class="token punctuation">.</span><span class="token function">getEthTransactionModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{3}&quot;</span><span class="token punctuation">,</span> transactionModel<span class="token punctuation">.</span><span class="token function">getEthTransactionModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="inputdatafilter-详解"><a href="#inputdatafilter-详解" class="header-anchor">#</a> InputDataFilter 详解</h4> <p>如果你想监控，某合约内的某函数 被调用的交易</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">EthMonitorFilter</span> <span class="token function">ethMonitorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">EthMonitorFilter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 合约地址</span>
                <span class="token punctuation">.</span><span class="token function">setInputDataFilter</span><span class="token punctuation">(</span> <span class="token comment">// 根据inputData筛选</span>
                        <span class="token class-name">InputDataFilter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setFunctionCode</span><span class="token punctuation">(</span><span class="token string">&quot;0xadasasdf&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 被调用的函数编码（inputData前十位）</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果 有一个合约[0x552115849813d334C58f2757037F68E2963C4c5e], 里面有一个函数是 transferFrom(address from, address to, uint256 amount)</p> <p>你想 实现一个监控：如果有人用这个合约里的这个函数，将代币转给[0x552115849813d334C58f2757037F68E2963C4c5e]时，就触发 Monitor事件，那么你可以这样写</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">EthMonitorFilter</span> <span class="token function">ethMonitorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">EthMonitorFilter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 合约地址</span>
                <span class="token punctuation">.</span><span class="token function">setInputDataFilter</span><span class="token punctuation">(</span> <span class="token comment">// 根据inputData筛选</span>
                        <span class="token class-name">InputDataFilter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setFunctionCode</span><span class="token punctuation">(</span>ERC20<span class="token punctuation">.</span>TRANSFER_FROM<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 被调用的函数编码（inputData前十位）</span>
                                <span class="token punctuation">.</span><span class="token function">setTypeReferences</span><span class="token punctuation">(</span> <span class="token comment">// 此方法的参数列表（仅类型）</span>
                                        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 第一个参数的类型</span>
                                        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 第二个参数的类型</span>
                                        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Uint256</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 第三个参数的类型</span>
                                <span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">// 筛选第二个参数（to） = 0x552115849813d334C58f2757037F68E2963C4c5e</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="开启一个扫块任务"><a href="#开启一个扫块任务" class="header-anchor">#</a> 开启一个扫块任务</h4> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">// 初始化线程池，核心线程数必须 &gt;= 全局的扫块的任务数量 + 全局的重试策略的数量</span>
<span class="token comment">// 这是一个全局配置，不管你开了几个任务，不管你需要扫描几条链，几种链，都只需要写一次这句代码</span>
<span class="token class-name">EventThreadPool</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开启一个扫块任务，如果你想扫描多个链，那么直接拷贝这段代码，并修改配置即可</span>
<span class="token class-name">MagicianBlockchainScan</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setRpcUrl</span><span class="token punctuation">(</span>
                <span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token comment">// 节点的RPC地址</span>
        <span class="token punctuation">.</span><span class="token function">setScanPeriod</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token comment">// 间隔多久，扫描下一个区块</span>
        <span class="token punctuation">.</span><span class="token function">setBeginBlockNumber</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">24318610</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 从哪个块高开始扫描</span>
        <span class="token punctuation">.</span><span class="token function">addEthMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加 监听事件</span>
        <span class="token punctuation">.</span><span class="token function">addEthMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加 监听事件</span>
        <span class="token punctuation">.</span><span class="token function">addEthMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加 监听事件</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="使用代理访问rpc地址"><a href="#使用代理访问rpc地址" class="header-anchor">#</a> 使用代理访问RPC地址</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 使用 addRpcUrl 方法的另一个重载，传入代理设置即可</span>
<span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545/&quot;</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token class-name">Proxy<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span>HTTP<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">4780</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// ---------- 除了上面那种以外，addRpcUrl 方法一共有这么几种重载，根据你的需求挑选合适的方法 ----------</span>

<span class="token comment">// 直接传入 wei3j的HttpService</span>
<span class="token comment">// 这种方法 可定制化最高，基本上就是web3j本来的使用方式</span>
<span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpService</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 传入okHttpClient</span>
<span class="token comment">// 这种方法 可定制化程度也非常高，基本上就是使用okHttp访问 区块链节点了</span>
<span class="token class-name">OkHttpClient</span> okHttpClient <span class="token operator">=</span> xxxxxx<span class="token punctuation">;</span>
<span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span>okHttpClient<span class="token punctuation">)</span>

<span class="token comment">// 有些代理服务器 需要鉴权，可以使用这种方式来设置用户名和密码</span>
<span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545/&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token class-name">Proxy<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span>HTTP<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">4780</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token class-name">Route</span> route<span class="token punctuation">,</span> <span class="token class-name">Response</span> response<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

                <span class="token comment">//设置代理服务器账号密码</span>
                <span class="token class-name">String</span> credential <span class="token operator">=</span> <span class="token class-name">Credentials</span><span class="token punctuation">.</span><span class="token function">basic</span><span class="token punctuation">(</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;密码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Proxy-Authorization&quot;</span><span class="token punctuation">,</span> credential<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
</code></pre></div><h3 id="tron链"><a href="#tron链" class="header-anchor">#</a> TRON链</h3> <h4 id="创建监听器-2"><a href="#创建监听器-2" class="header-anchor">#</a> 创建监听器</h4> <p>条件过滤器还在开发中，可以关注后续更新，call方法会接收到所有扫描到的交易信息，需要您自己判断筛选</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 创建一个类，实现TronMonitorEvent接口即可
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TronEventOne</span> <span class="token keyword">implements</span> <span class="token class-name">TronMonitorEvent</span> <span class="token punctuation">{</span>

        <span class="token comment">/**
         * transactionModel 对象里包含此条交易的所有信息
         */</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">TransactionModel</span> transactionModel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;TRON 成功了！！！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;TRON, txID: &quot;</span> <span class="token operator">+</span> transactionModel<span class="token punctuation">.</span><span class="token function">getTronTransactionModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTxID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="开启一个扫块任务-2"><a href="#开启一个扫块任务-2" class="header-anchor">#</a> 开启一个扫块任务</h4> <p>下面标出了跟ETH扫块任务的两个区别，除此之外，再无其他区别</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 初始化线程池，核心线程数必须 &gt;= 全局的扫块的任务数量 + 全局的重试策略的数量</span>
<span class="token comment">// 这是一个全局配置，不管你开了几个任务，不管你需要扫描几条链，几种链，都只需要写一次这句代码</span>
<span class="token class-name">EventThreadPool</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">MagicianBlockchainScan</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setRpcUrl</span><span class="token punctuation">(</span>
                <span class="token comment">// 跟ETH的区别一，这里需要用TronRpcInit</span>
                <span class="token class-name">TronRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.shasta.trongrid.io/wallet&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addTronMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TronEventOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 跟ETH的区别二，添加监听器需要用 addTronMonitorEvent</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="使用代理访问rpc地址-2"><a href="#使用代理访问rpc地址-2" class="header-anchor">#</a> 使用代理访问RPC地址</h4> <div class="language-java extra-class"><pre class="language-java"><code>开发中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="solana链"><a href="#solana链" class="header-anchor">#</a> SOLANA链</h3> <div class="language-java extra-class"><pre class="language-java"><code>开发中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="停止某一个扫块任务"><a href="#停止某一个扫块任务" class="header-anchor">#</a> 停止某一个扫块任务</h3> <p>三条链都是一样的写法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 将对象拿到</span>
<span class="token class-name">MagicianBlockchainScan</span> blockChainScan <span class="token operator">=</span> <span class="token class-name">MagicianBlockchainScan</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setRpcUrl</span><span class="token punctuation">(</span>
                <span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token comment">// 节点的RPC地址</span>
        <span class="token punctuation">.</span><span class="token function">setScanPeriod</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token comment">// 间隔多久，扫描下一个区块</span>
        <span class="token punctuation">.</span><span class="token function">setBeginBlockNumber</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">24318610</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 从哪个块高开始扫描</span>
        <span class="token punctuation">.</span><span class="token function">addEthMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加 监听事件</span>
        <span class="token punctuation">.</span><span class="token function">addEthMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加 监听事件</span>
        <span class="token punctuation">.</span><span class="token function">addEthMonitorEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加 监听事件</span>

<span class="token comment">// 因为start方法没有返回值，所以上面的链式不可以调用start，需要改成用返回的对象来调用</span>
blockChainScan<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用这个方法可以停止这一个扫块任务</span>
blockChainScan<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="配置多个rpc-url-实现负载均衡"><a href="#配置多个rpc-url-实现负载均衡" class="header-anchor">#</a> 配置多个RPC URL 实现负载均衡</h3> <p>三条链都是一样的，只是EthRpcInit 需要改成对应的链的类</p> <p>调用addRpcUrl方法多次，传入多个RPC URL，即可实现负载均衡（轮询）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MagicianBlockchainScan</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setRpcUrl</span><span class="token punctuation">(</span>
                <span class="token class-name">EthRpcInit</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-2-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addRpcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s2.binance.org:8545&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token comment">// 节点的RPC地址</span>
</code></pre></div><h3 id="重试策略-三条链都是一样的写法"><a href="#重试策略-三条链都是一样的写法" class="header-anchor">#</a> 重试策略（三条链都是一样的写法）</h3> <p>在符合以下两个条件时，会发生重试，两个条件必须全都符合 才会触发重试</p> <ol><li>当前正在扫描的块高 是空的（块不存在 或者 块里面没交易）</li> <li>当前正在扫描的块高 &lt; 链上的最新块高</li></ol> <p>当上面两个条件同时符合的时候，扫描任务会跳过这个块，然后继续扫描下一个块，同时 重试策略会收到被跳过的块高，
你可以在重试策略里 自己处理</p> <h4 id="创建一个重试策略"><a href="#创建一个重试策略" class="header-anchor">#</a> 创建一个重试策略</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EthRetry</span> <span class="token keyword">implements</span> <span class="token class-name">RetryStrategy</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span> blockNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="将重试策略添加到扫描任务中"><a href="#将重试策略添加到扫描任务中" class="header-anchor">#</a> 将重试策略添加到扫描任务中</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MagicianBlockchainScan</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setRetryStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EthRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 调用这个方法添加</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="需要注意线程数量的配置"><a href="#需要注意线程数量的配置" class="header-anchor">#</a> 需要注意线程数量的配置</h4> <p>如果你此时开了一个扫块任务 + 一个 重试策略，那么需要占用两个线程，所以参数必须传2</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 初始化线程池，核心线程数必须 &gt;= 全局的扫块的任务数量 + 全局的重试策略的数量</span>
<span class="token comment">// 这是一个全局配置，不管你开了几个任务，不管你需要扫描几条链，几种链，都只需要写一次这句代码</span>
<span class="token class-name">EventThreadPool</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="inputdata-编解码"><a href="#inputdata-编解码" class="header-anchor">#</a> InputData 编解码</h3> <h4 id="eth-bsc-poygan-等-链-2"><a href="#eth-bsc-poygan-等-链-2" class="header-anchor">#</a> ETH(BSC, POYGAN 等)链</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 编码</span>
<span class="token class-name">String</span> inputData <span class="token operator">=</span> <span class="token class-name">EthAbiCodec</span><span class="token punctuation">.</span><span class="token function">getInputData</span><span class="token punctuation">(</span>
            <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 方法名</span>
            <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 参数1</span>
            <span class="token keyword">new</span> <span class="token class-name">Uint256</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 参数2，如果还有其他参数，可以继续传入下一个</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 解码</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Type</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">EthAbiCodec</span><span class="token punctuation">.</span><span class="token function">decoderInputData</span><span class="token punctuation">(</span>
            <span class="token string">&quot;0x&quot;</span> <span class="token operator">+</span> inputData<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 去除方法签名的inputData</span>
            <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 被编码的方法的参数1 类型</span>
            <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Uint256</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 被编码的方法的参数2 类型， 如果还有其他参数，可以继续传入下一个</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type <span class="token operator">:</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取方法签名，其实就是inputData的前十位</span>
<span class="token class-name">String</span> functionCode <span class="token operator">=</span> <span class="token class-name">EthAbiCodec</span><span class="token punctuation">.</span><span class="token function">getFunAbiCode</span><span class="token punctuation">(</span>
            <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 方法名</span>
            <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 参数1，值随意传，反正我们要的方法签名，不是完整的inputData</span>
            <span class="token keyword">new</span> <span class="token class-name">Uint256</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 参数2，值随意传，反正我们要的方法签名，不是完整的inputData，如果还有其他参数，可以继续传入下一个</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="tron"><a href="#tron" class="header-anchor">#</a> TRON</h4> <div class="language-java extra-class"><pre class="language-java"><code>开发中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h4 id="solana"><a href="#solana" class="header-anchor">#</a> SOLANA</h4> <div class="language-java extra-class"><pre class="language-java"><code>开发中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="项目内置了几个functioncode-eth专用"><a href="#项目内置了几个functioncode-eth专用" class="header-anchor">#</a> 项目内置了几个functionCode（ETH专用）</h3> <p>如果你刚好要监听这几个函数，那么可以直接用，前提是你的合约里的函数必须跟 Openzeppelin 的规范一样，连参数列表的顺序都必须一样</p> <h4 id="erc20"><a href="#erc20" class="header-anchor">#</a> ERC20</h4> <div class="language-java extra-class"><pre class="language-java"><code>ERC20<span class="token punctuation">.</span>TRANSFER<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC20<span class="token punctuation">.</span>APPROVE<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC20<span class="token punctuation">.</span>TRANSFER_FROM<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="erc721"><a href="#erc721" class="header-anchor">#</a> ERC721</h4> <div class="language-java extra-class"><pre class="language-java"><code>ERC721<span class="token punctuation">.</span>SAFE_TRANSFER_FROM<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC721<span class="token punctuation">.</span>SAFE_TRANSFER_FROM_TWO<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有data的那个</span>
ERC721<span class="token punctuation">.</span>TRANSFER_FROM<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC721<span class="token punctuation">.</span>APPROVE<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC721<span class="token punctuation">.</span>SET_APPROVAL_FOR_ALL<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="erc1155"><a href="#erc1155" class="header-anchor">#</a> ERC1155</h4> <div class="language-java extra-class"><pre class="language-java"><code>ERC1155<span class="token punctuation">.</span>SET_APPROVAL_FOR_ALL<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC1155<span class="token punctuation">.</span>SAFE_TRANSFER_FROM<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERC1155<span class="token punctuation">.</span>SAFE_BATCH_TRANSFER_FROM<span class="token punctuation">.</span><span class="token function">getFunctionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="magician-contractstools"><a href="#magician-contractstools" class="header-anchor">#</a> Magician-ContractsTools</h2> <p>Magician-ContractsTools是一个用于调用智能合约的工具包，你可以非常容易地在Java程序中调用智能合约进行查询和写入操作。</p> <p>有三个内置的标准合约模板，分别是ERC20、ERC721和ERC1155，如果你需要调用这三个合约中的标准函数，可以帮助你非常快速地完成工作。除了内置的合同模板外，如果你需要调用自定义的合同函数也是很容易的，以后我们还会继续增加标准模板。</p> <p>此外，还有InputData解码和ETH查询和转移的工具</p> <p>计划支持三种链，ETH（BSC、POLYGON等）、SOL和TRON</p> <h3 id="导入依赖-2"><a href="#导入依赖-2" class="header-anchor">#</a> 导入依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.yuyenews<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Magician-ContractsTools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- This is the logging package, you must have it or the console will not see anything, any logging package that can bridge with slf4j is supported --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-jdk14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="合约查询-以及-写入"><a href="#合约查询-以及-写入" class="header-anchor">#</a> 合约查询 以及 写入</h3> <p>初始化合约工具对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> privateKey <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 私钥</span>
<span class="token class-name">Web3j</span> web3j <span class="token operator">=</span> <span class="token class-name">Web3j</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpService</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 链的RPC地址</span>

<span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">EthContractUtil</span> ethContractUtil <span class="token operator">=</span> <span class="token class-name">EthContractUtil</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>web3j<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查询合约</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Type</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> ethContractUtil<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>
            contractAddress<span class="token punctuation">,</span> <span class="token comment">// 合约地址</span>
            <span class="token class-name">EthAbiCodecTool</span><span class="token punctuation">.</span><span class="token function">getInputData</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;balanceOf&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 要调用的方法名称</span>
                    <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>toAddress<span class="token punctuation">)</span> <span class="token comment">// 方法的参数，如果有多个，可以继续传入下一个参数</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 要调用的方法的inputData</span>
            <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Uint256</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 方法的返回类型，如果有多个返回值，可以继续传入下一个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>写入合约</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 往合约里写入数据</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> ethContractUtil<span class="token punctuation">.</span><span class="token function">sendRawTransaction</span><span class="token punctuation">(</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setToAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span> <span class="token comment">// 合约地址</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setNonce</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自定义nonce，如果想要默认值 可以直接传null，或者不传这个参数</span>
                <span class="token class-name">EthAbiCodecTool</span><span class="token punctuation">.</span><span class="token function">getInputData</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 要调用的方法名称</span>
                        <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 方法的参数，如果有多个，可以继续传入下一个参数</span>
                        <span class="token keyword">new</span> <span class="token class-name">Uint256</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 方法的参数，如果有多个，可以继续传入下一个参数</span>
                <span class="token punctuation">)</span> <span class="token comment">// 要调用的方法的inputData</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>
</code></pre></div><h3 id="合约模板"><a href="#合约模板" class="header-anchor">#</a> 合约模板</h3> <p>目前只有三种模板，后面会继续增加</p> <h4 id="调用erc20合约"><a href="#调用erc20合约" class="header-anchor">#</a> 调用ERC20合约</h4> <p>初始化合约模板</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Web3j</span> web3j <span class="token operator">=</span> <span class="token class-name">Web3j</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpService</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-2-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">ERC20Contract</span> erc20Contract <span class="token operator">=</span> <span class="token class-name">ERC20Contract</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>web3j<span class="token punctuation">,</span> contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查询</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 调用合约的 totalSupply 函数</span>
<span class="token class-name">BigInteger</span> total <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">totalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用合约的 balanceOf 函数</span>
<span class="token class-name">BigInteger</span> amount <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用合约的 allowance 函数</span>
<span class="token class-name">BigInteger</span> amount <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">allowance</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>写入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 调用合约的 transfer 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 转账金额</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用合约的 transferFrom 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账付款人</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 转账金额</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用合约的 approve 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 被授权人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 授权金额</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>
</code></pre></div><h4 id="调用erc721合约"><a href="#调用erc721合约" class="header-anchor">#</a> 调用ERC721合约</h4> <p>初始化合约模板</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Web3j</span> web3j <span class="token operator">=</span> <span class="token class-name">Web3j</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpService</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-2-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">ERC721Contract</span> erc721Contract <span class="token operator">=</span> <span class="token class-name">ERC721Contract</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>web3j<span class="token punctuation">,</span> contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查询</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 调用合约的 balanceOf 函数</span>
<span class="token class-name">BigInteger</span> amount <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用合约的 ownerOf 函数</span>
<span class="token class-name">String</span> ownerAddress <span class="token operator">=</span> erc721Contract<span class="token punctuation">.</span><span class="token function">ownerOf</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用 isApprovedForAll 函数</span>
<span class="token class-name">Boolean</span> result <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">isApprovedForAll</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用 getApproved 函数</span>
<span class="token class-name">String</span> approvedAddress <span class="token operator">=</span> erc721Contract<span class="token punctuation">.</span><span class="token function">getApproved</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>写入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 调用 approve 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc721Contract<span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 被授权人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 授权的tokenId</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用合约的 transferFrom 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账付款人</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// tokenId</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用合约的 safeTransferFrom 函数(没有data参数的那个)</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">safeTransferFrom</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账付款人</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// tokenId</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用合约的 safeTransferFrom 函数(有data参数的那个)</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc20Contract<span class="token punctuation">.</span><span class="token function">safeTransferFrom</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账付款人</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// tokenId</span>
                <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// data</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用 setApprovalForAll 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">setApprovalForAll</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 被授权人</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否授权全部</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>
</code></pre></div><h4 id="调用erc1155合约"><a href="#调用erc1155合约" class="header-anchor">#</a> 调用ERC1155合约</h4> <p>初始化合约模板</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Web3j</span> web3j <span class="token operator">=</span> <span class="token class-name">Web3j</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpService</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-2-s1.binance.org:8545&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">ERC1155Contract</span> erc1155Contract <span class="token operator">=</span> <span class="token class-name">ERC1155Contract</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>web3j<span class="token punctuation">,</span> contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查询</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 调用 balanceOf 函数</span>
<span class="token class-name">BigInteger</span> amount <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用 balanceOfBatch 函数</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
address<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
address<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigInteger</span><span class="token punctuation">&gt;</span></span> tokenId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tokenId<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tokenId<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigInteger</span><span class="token punctuation">&gt;</span></span> amounts <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">balanceOfBatch</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用 isApprovedForAll 函数</span>
<span class="token class-name">Boolean</span> result <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">isApprovedForAll</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>写入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 调用 setApprovalForAll 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">setApprovalForAll</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 被授权人</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否授权全部</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用 safeTransferFrom 函数</span>
<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">safeTransferFrom</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账付款人</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// tokenId</span>
                <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 数量</span>
                <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// data</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>

<span class="token comment">// 调用 safeBatchTransferFrom 函数</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigInteger</span><span class="token punctuation">&gt;</span></span> tokenIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tokenIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tokenIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigInteger</span><span class="token punctuation">&gt;</span></span> amounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
amounts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
amounts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">SendResultModel</span> sendResultModel <span class="token operator">=</span> erc1155Contract<span class="token punctuation">.</span><span class="token function">safeBatchTransferFrom</span><span class="token punctuation">(</span>
                <span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账付款人</span>
                <span class="token string">&quot;0x552115849813d334C58f2757037F68E2963C4c5e&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转账接收人</span>
                tokenIds<span class="token punctuation">,</span> <span class="token comment">// tokenId 集合</span>
                amounts<span class="token punctuation">,</span> <span class="token comment">// 数量 集合</span>
                <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// data</span>
                <span class="token class-name">SendModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSenderAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xb4e32492E9725c3215F1662Cf28Db1862ed1EE84&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用者的地址</span>
                        <span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token comment">// senderAddress的私钥</span>
                        <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 主链币数量，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasPrice，如果想用默认值 可以直接传null，或者不传这个参数</span>
                        <span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;800000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// gasLimit，如果想用默认值 可以直接传null，或者不传这个参数</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthSendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送交易后的结果</span>
sendResultModel<span class="token punctuation">.</span><span class="token function">getEthGetTransactionReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交易成功上链后的结果</span>
</code></pre></div><h3 id="inputdata-编解码-2"><a href="#inputdata-编解码-2" class="header-anchor">#</a> InputData 编解码</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 编码</span>
<span class="token class-name">String</span> inputData <span class="token operator">=</span> <span class="token class-name">EthAbiCodecTool</span><span class="token punctuation">.</span><span class="token function">getInputData</span><span class="token punctuation">(</span>
            <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 方法名</span>
            <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 参数1</span>
            <span class="token keyword">new</span> <span class="token class-name">Uint256</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 参数2，如果还有其他参数，可以继续传入下一个</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 解码</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Type</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">EthAbiCodecTool</span><span class="token punctuation">.</span><span class="token function">decoderInputData</span><span class="token punctuation">(</span>
            <span class="token string">&quot;0x&quot;</span> <span class="token operator">+</span> inputData<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 去除方法签名的inputData</span>
            <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 被编码的方法的参数1 类型</span>
            <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Uint256</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 被编码的方法的参数2 类型， 如果还有其他参数，可以继续传入下一个</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type <span class="token operator">:</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取方法签名，其实就是inputData的前十位</span>
<span class="token class-name">String</span> functionCode <span class="token operator">=</span> <span class="token class-name">EthAbiCodecTool</span><span class="token punctuation">.</span><span class="token function">getFunAbiCode</span><span class="token punctuation">(</span>
            <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 方法名</span>
            <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 参数1，值随意传，反正我们要的方法签名，不是完整的inputData</span>
            <span class="token keyword">new</span> <span class="token class-name">Uint256</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 参数2，值随意传，反正我们要的方法签名，不是完整的inputData，如果还有其他参数，可以继续传入下一个</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="主链币查询以及转账"><a href="#主链币查询以及转账" class="header-anchor">#</a> 主链币查询以及转账</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> privateKey <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 私钥</span>
<span class="token class-name">Web3j</span> web3j <span class="token operator">=</span> <span class="token class-name">Web3j</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpService</span><span class="token punctuation">(</span><span class="token string">&quot;https://data-seed-prebsc-1-s1.binance.org:8545/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 链的RPC地址</span>

<span class="token class-name">EthHelper</span> ethHelper <span class="token operator">=</span> <span class="token class-name">EthHelper</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>web3j<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 余额查询</span>
<span class="token class-name">BigInteger</span> balance <span class="token operator">=</span> ethHelper<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span>fromAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 转账</span>
<span class="token class-name">TransactionReceipt</span> transactionReceipt <span class="token operator">=</span> ethHelper<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>
            toAddress<span class="token punctuation">,</span>
            privateKey<span class="token punctuation">,</span> 
            <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Convert<span class="token punctuation">.</span>Unit</span><span class="token punctuation">.</span>ETHER
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/cn/assets/js/app.ae022c5b.js" defer></script><script src="/cn/assets/js/2.09610e94.js" defer></script><script src="/cn/assets/js/9.07247551.js" defer></script>
  </body>
</html>
