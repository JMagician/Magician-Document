<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Magician-DataProcessing | Magician</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?4a88f95406930c3f864feabd8e0b5c12";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
    <meta name="description" content="一个用Java开发的数据处理框架，支持并发处理以及生产者与消费者模型">
    <meta name="keywords" content="Magician,Magician框架,小型服务框架,开源http服务,web开发,Java,开源项目,NIO,区块链开发,以太坊,扫块,ETH,ARB,arb,eth,blockchain">
    
    <link rel="preload" href="/assets/css/0.styles.e1700646.css" as="style"><link rel="preload" href="/assets/js/app.f4fe6fe1.js" as="script"><link rel="preload" href="/assets/js/2.09610e94.js" as="script"><link rel="preload" href="/assets/js/10.fea173a3.js" as="script"><link rel="prefetch" href="/assets/js/11.1b7db89d.js"><link rel="prefetch" href="/assets/js/12.e07a3e8f.js"><link rel="prefetch" href="/assets/js/13.58334641.js"><link rel="prefetch" href="/assets/js/14.109c2be9.js"><link rel="prefetch" href="/assets/js/3.19c68e75.js"><link rel="prefetch" href="/assets/js/4.b7b73457.js"><link rel="prefetch" href="/assets/js/5.136e2504.js"><link rel="prefetch" href="/assets/js/6.a9aa8f92.js"><link rel="prefetch" href="/assets/js/7.76b505c0.js"><link rel="prefetch" href="/assets/js/8.a516c2ac.js"><link rel="prefetch" href="/assets/js/9.bd401bb4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e1700646.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Magician</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Github" class="dropdown-title"><span class="title">Github</span> <span class="arrow down"></span></button> <button type="button" aria-label="Github" class="mobile-dropdown-title"><span class="title">Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/JMagician/Magician-DataProcessing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Magician-DataProcessing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Magician-Blockchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  区块链
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/JMagician" target="_blank" rel="noopener noreferrer" class="nav-link external">
  其他
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dataprocessing/index.html" class="nav-link">
  Magician-DataProcessing
</a></li><li class="dropdown-item"><!----> <a href="/chain/index.html" class="nav-link">
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/web/index.html" class="nav-link">
  Magician-Http
</a></li><li class="dropdown-item"><!----> <a href="/db/index.html" class="nav-link">
  Magician-JDBC
</a></li><li class="dropdown-item"><!----> <a href="/web/magician-web.html" class="nav-link">
  Magician-Web
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="赞助" class="dropdown-title"><span class="title">赞助</span> <span class="arrow down"></span></button> <button type="button" aria-label="赞助" class="mobile-dropdown-title"><span class="title">赞助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sponsor/sponsor.html" class="nav-link">
  微信支付宝
</a></li><li class="dropdown-item"><!----> <a href="https://afdian.com/a/magicianio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  爱发电
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.paypal.com/paypalme/yuye666" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Paypal
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/business/business.html" class="nav-link">
  商业合作
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Github" class="dropdown-title"><span class="title">Github</span> <span class="arrow down"></span></button> <button type="button" aria-label="Github" class="mobile-dropdown-title"><span class="title">Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/JMagician/Magician-DataProcessing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Magician-DataProcessing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Magician-Blockchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  区块链
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/JMagician" target="_blank" rel="noopener noreferrer" class="nav-link external">
  其他
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dataprocessing/index.html" class="nav-link">
  Magician-DataProcessing
</a></li><li class="dropdown-item"><!----> <a href="/chain/index.html" class="nav-link">
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/web/index.html" class="nav-link">
  Magician-Http
</a></li><li class="dropdown-item"><!----> <a href="/db/index.html" class="nav-link">
  Magician-JDBC
</a></li><li class="dropdown-item"><!----> <a href="/web/magician-web.html" class="nav-link">
  Magician-Web
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="赞助" class="dropdown-title"><span class="title">赞助</span> <span class="arrow down"></span></button> <button type="button" aria-label="赞助" class="mobile-dropdown-title"><span class="title">赞助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sponsor/sponsor.html" class="nav-link">
  微信支付宝
</a></li><li class="dropdown-item"><!----> <a href="https://afdian.com/a/magicianio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  爱发电
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.paypal.com/paypalme/yuye666" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Paypal
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/business/business.html" class="nav-link">
  商业合作
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Magician-DataProcessing</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dataprocessing/#初始化配置" class="sidebar-link">初始化配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dataprocessing/#导入依赖" class="sidebar-link">导入依赖</a></li></ul></li><li><a href="/dataprocessing/#并发处理任务" class="sidebar-link">并发处理任务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dataprocessing/#并发处理list-set等所有collection类的集合里的元素" class="sidebar-link">并发处理List，Set等所有Collection类的集合里的元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dataprocessing/#同步执行" class="sidebar-link">同步执行</a></li><li class="sidebar-sub-header"><a href="/dataprocessing/#异步执行" class="sidebar-link">异步执行</a></li></ul></li><li><a href="/dataprocessing/#并发处理所有map类的集合里的元素" class="sidebar-link">并发处理所有Map类的集合里的元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dataprocessing/#同步执行-2" class="sidebar-link">同步执行</a></li><li class="sidebar-sub-header"><a href="/dataprocessing/#异步执行-2" class="sidebar-link">异步执行</a></li></ul></li><li><a href="/dataprocessing/#生产者与消费者" class="sidebar-link">生产者与消费者</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dataprocessing/#我们先创建一个生产者" class="sidebar-link">我们先创建一个生产者</a></li><li class="sidebar-sub-header"><a href="/dataprocessing/#再创建一个消费者" class="sidebar-link">再创建一个消费者</a></li><li class="sidebar-sub-header"><a href="/dataprocessing/#然后将他们添加到同一个组内" class="sidebar-link">然后将他们添加到同一个组内</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="magician-dataprocessing"><a href="#magician-dataprocessing" class="header-anchor">#</a> Magician-DataProcessing</h1> <p>Magician-DataProcessing 是一个用Java开发的数据处理框架，支持并发处理以及生产者与消费者模型</p> <h2 id="初始化配置"><a href="#初始化配置" class="header-anchor">#</a> 初始化配置</h2> <h3 id="导入依赖"><a href="#导入依赖" class="header-anchor">#</a> 导入依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.yuyenews<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Magician-DataProcessing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="并发处理任务"><a href="#并发处理任务" class="header-anchor">#</a> 并发处理任务</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentTaskSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 超时时间</span>
                <span class="token punctuation">.</span><span class="token function">setTimeUnit</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span> <span class="token comment">// 超时时间的单位</span>
                <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 添加一个任务</span>

                    <span class="token comment">// 在这里可以写上任务的业务逻辑</span>

                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 此任务处理后的回调</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ConcurrentTaskResultEnum</span><span class="token punctuation">.</span>FAIL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">// 任务失败，此时e里面有详细的异常信息</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ConcurrentTaskResultEnum</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 任务成功，此时e是空的</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 添加一个任务</span>

                    <span class="token comment">// 在这里可以写上任务的业务逻辑</span>

                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 此任务处理后的回调</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ConcurrentTaskResultEnum</span><span class="token punctuation">.</span>FAIL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">// 任务失败，此时e里面有详细的异常信息</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ConcurrentTaskResultEnum</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 任务成功，此时e是空的</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>添加进去的任务会并发执行，但是在它们执行完之前，这整个代码块会同步等待在这，一直等到所有任务执行完或者超时才会继续往下走。</p> <p>这里面的超时时间就是用来设置同步等待多久的。</p> <ul><li>如果设置为0表示一直等到所有任务完成为止</li> <li>设置为大于0的时候，表示只等待这么久</li></ul> <h2 id="并发处理list-set等所有collection类的集合里的元素"><a href="#并发处理list-set等所有collection类的集合里的元素" class="header-anchor">#</a> 并发处理List，Set等所有Collection类的集合里的元素</h2> <h3 id="同步执行"><a href="#同步执行" class="header-anchor">#</a> 同步执行</h3> <p>假如有一个List需要并发处理里面的元素</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>只需要将他传入syncRunner方法即可</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentCollectionSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">syncRunner</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
            <span class="token comment">// List里的元素是什么类型，这个data就是什么类型</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这个方法会将传进去的集合分成若干组，每组的大小由参数指定。</p> <p>这些组会排队执行，但是每一组在执行的时候都是并发的，里面的每一个元素都会由单独的线程去处理。</p> <p>需要等一组处理完了，才会处理下一组，但是有时候我们不想这么死板的等待，所以可以设置一个超时时间，超过了这个期限就不等了，直接进行下一组，所以这里的最后两个参数就是用来设置这个期限的。</p> <h4 id="也可以让每一组单独占一个线程"><a href="#也可以让每一组单独占一个线程" class="header-anchor">#</a> 也可以让每一组单独占一个线程</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 也可以用syncGroupRunner方法</span>
<span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentCollectionSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">syncGroupRunner</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里是每一组List</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> item <span class="token operator">:</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这个方法会将传进去的集合分成若干组，每组的大小由参数指定。</p> <p>每一组由单独的线程处理。</p> <p>会一直同步等待在这里，直到所有组都处理完了才会进行下一步，但是有时候我们不想这么死板的等待，所以可以设置一个超时时间，超过了这个期限就不等了，直接执行下一步。所以这里的最后两个参数就是用来设置这个期限的。</p> <h3 id="异步执行"><a href="#异步执行" class="header-anchor">#</a> 异步执行</h3> <p>其实就是将上面【同步执行】的代码放到了一个线程里，内部处理依然是上面【同步执行】的逻辑，但是这整个代码块将会异步执行，不需要等在这。所以个别相同的参数就不再重复解释了。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 假如有一个List需要并发处理里面的元素</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="每个元素并发执行"><a href="#每个元素并发执行" class="header-anchor">#</a> 每个元素并发执行</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 只需要将他传入asyncRunner方法即可</span>
<span class="token class-name">MagicianDataProcessing<span class="token punctuation">.</span>ConcurrentCollectionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncRunner</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 注意，异步执行需要调用start方法</span>
</code></pre></div><p>还可以这样写</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MagicianDataProcessing<span class="token punctuation">.</span>ConcurrentCollectionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncRunner</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里是每一组List</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> item <span class="token operator">:</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncRunner</span><span class="token punctuation">(</span>dataList2<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncRunner</span><span class="token punctuation">(</span>dataList3<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一样要调用start方法</span>
</code></pre></div><h4 id="每一组并发执行"><a href="#每一组并发执行" class="header-anchor">#</a> 每一组并发执行</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 也可以用asyncGroupRunner方法，每个参数的具体含义可以参考文档</span>
<span class="token class-name">MagicianDataProcessing<span class="token punctuation">.</span>ConcurrentCollectionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncGroupRunner</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        
            <span class="token comment">// 这里是每一组List</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> item <span class="token operator">:</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 这里可以拿到List里的元素，进行处理</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 每组多少条元素</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 每组之间同步等待多久</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES <span class="token comment">// 等待的时间单位</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一样要调用start方法</span>
</code></pre></div><p>同上</p> <h2 id="并发处理所有map类的集合里的元素"><a href="#并发处理所有map类的集合里的元素" class="header-anchor">#</a> 并发处理所有Map类的集合里的元素</h2> <p>Map的逻辑跟Collection一模一样，只不过是传入的集合变成了Map，就不再累述了，感谢理解。</p> <h3 id="同步执行-2"><a href="#同步执行-2" class="header-anchor">#</a> 同步执行</h3> <h4 id="每个元素并发执行-2"><a href="#每个元素并发执行-2" class="header-anchor">#</a> 每个元素并发执行</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 假如有一个Map需要并发处理里面的元素</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 只需要将他传入syncRunner方法即可</span>
<span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentMapSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">syncRunner</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里可以拿到Map里的元素，进行处理</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="每一组并发执行-2"><a href="#每一组并发执行-2" class="header-anchor">#</a> 每一组并发执行</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 也可以用syncGroupRunner方法</span>
<span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentMapSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">syncGroupRunner</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里是每一组Map</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> data<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 这里可以拿到Map里的每一个元素</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="异步执行-2"><a href="#异步执行-2" class="header-anchor">#</a> 异步执行</h3> <h4 id="每个元素并发执行-3"><a href="#每个元素并发执行-3" class="header-anchor">#</a> 每个元素并发执行</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 假如有一个Map需要并发处理里面的元素</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 只需要将他传入asyncRunner方法即可</span>
<span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentMapAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncRunner</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// 这里可以拿到Map里的元素，进行处理</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> 
        <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一样要调用start方法</span>
</code></pre></div><h4 id="每一组并发执行-3"><a href="#每一组并发执行-3" class="header-anchor">#</a> 每一组并发执行</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 也可以用asyncGroupRunner方法</span>
<span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getConcurrentMapAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asyncGroupRunner</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">,</span> data <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        
            <span class="token comment">// 这里是每一组Map</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> data<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 这里可以拿到Map里的每一个元素</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token number">10</span><span class="token punctuation">,</span> 
        <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一样要调用start方法;</span>
</code></pre></div><h2 id="生产者与消费者"><a href="#生产者与消费者" class="header-anchor">#</a> 生产者与消费者</h2> <p>这是一个多对多的模型，多个生产者可以给多个消费者推送不同类型的数据，</p> <h3 id="我们先创建一个生产者"><a href="#我们先创建一个生产者" class="header-anchor">#</a> 我们先创建一个生产者</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoProducer</span> <span class="token keyword">extends</span> <span class="token class-name">MagicianProducer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 设置ID，必须全局唯一，默认是当前类的全名
     * 如果采用默认值，可以不重写这个方法
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置producer方法是否重复执行，默认重复
     * 如果采用默认值，可以不重写这个方法
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">getLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置 是否等消费者全部空闲了才继续生产下一轮数据，默认false
     * 如果采用默认值，可以不重写这个方法
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">getAllFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getAllFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 当生产者启动后，会自动执行这个方法，我们可以在这个方法里生产数据，并通过publish方法发布给消费者
     *
     * 这边举一个例子
     * 假如我们需要不断地扫描某张表，根据里面的数据状态去执行一些业务逻辑
     * 那么我们可以在这个方法里写一个查询的逻辑，然后将查询到数据发送给消费者
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 根据上面的例子，我们可以查询这张表里符合条件的数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 然后将他推送给消费者</span>
        <span class="token comment">// 可以推送任意类型的数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
          * 如果你只需要执行一次，那么到此就结束了，这个生产者也可以被回收掉了
          *
          * 但是如果你需要不断地执行上述操作，来维护这张表里的数据，这个时候你有两种做法
          * 第一种：加一个while循环
          *      但是这种方式有个问题，如果消费者的消费速度跟不上，那么就很容易造成消费者队列积压，出现内存问题。
          *      而数据积压太久又会影响时效性，可能你推送给消费者的时候，这条数据需要处理，但是等到被消费的时候又不需要处理了，这样容易出现数据错乱的问题。
          *
          * 第二种：等消费者把你推给他的数据消费完了，再推送下一轮，而我们就是采用的这种
          *      如果你想用这种方式，那么你不需要再写其他的任何逻辑，只需要将上面提到的getLoop方法重写一下，并返回true即可
          *      当你设置为true以后，生产者在推送完一轮后会不断地监视消费者，当发现了空闲的消费者才会生产和推送下一轮数据，并且数据只会推送给这几个空闲的消费者
          *
          * 如果你想等所有消费者都空闲了以后再推送下一轮，而不是发现一个空闲的就推送一轮
          * 那么你可以重写上面提到的getAllFree方法，返回true即可
          */</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="再创建一个消费者"><a href="#再创建一个消费者" class="header-anchor">#</a> 再创建一个消费者</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoConsumer</span> <span class="token keyword">extends</span> <span class="token class-name">MagicianConsumer</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 设置ID，必须全局唯一，默认是当前类的全名
     * 如果采用默认值，可以不重写这个方法
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 心跳通知，消费者每消费一个任务，都会触发一下这个方法
     * 我们可以根据他触发的频率来判断这个消费者的活跃度
     *
     * 注意！！！
     * 这个方法里不可以有耗时的操作，不然会将消费者阻塞的
     * 如果一定要加耗时的操作，那么务必在新线程里搞
     * @param id
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pulse</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// 如果你需要在这个方法里搞一些耗时的操作，那么务必要像这样开启一个新线程</span>
            <span class="token comment">// 不然消费者会被阻塞的</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 消费频率限制，默认10毫秒，取值范围：0 - long的最大值，单位：毫秒
     *
     * 如果任务执行的耗时小于execFrequencyLimit，则等待execFrequencyLimit毫秒后再消费下一个任务
     *
     * 首先这是一个生产者和消费者多对多的模型结构，我们以一个生产者对多个消费者来举例
     * 生产者生产的数据只有一份，但是他会推送给多个消费者
     * 而我们之所以要配置多个消费者，是因为需要他们执行不同的业务逻辑
     * 多个消费者执行的业务逻辑不同，也就意味着他们需要的数据大概率会不同
     *
     * 比如消费者A需要处理男性的数据，消费者B需要处理女性的数据
     * 如果生产者刚好连续推送了几批男性的数据，那么这会导致消费者B筛选不到女性数据，那么他就不会处理业务逻辑了
     * 这么一来，消费者B就会无限接近空转，而空转会引起CPU占用率过大，所以必须加以限制
     *
     * 千万不要小看这个问题，本人曾经在实战中亲测过，做不做这个限制，CPU的占有率会达到10倍的差距
     * 当然了，这跟消费者的业务逻辑还是有一定关系的，具体情况具体看待
     * 如果你的消费者几乎不会出现空转，那么这里可以设置为0
     *
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getExecFrequencyLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getExecFrequencyLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 这个方法会接收到生产者推送过来的数据
     * 在里面执行相应的业务逻辑即可
     * @param data
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doRunner</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// data 可以是任何类型</span>
        <span class="token comment">// 因为能给他推送数据的消费者是固定的，所以data有可能收到的类型也是固定的</span>
        <span class="token comment">// 所以我们可以在这里自己判断，然后转化即可</span>
        <span class="token comment">// 为什么不用泛型？这是为了兼容多个生产者，因为他们推送的数据类型可能会不同</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="然后将他们添加到同一个组内"><a href="#然后将他们添加到同一个组内" class="header-anchor">#</a> 然后将他们添加到同一个组内</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 创建一组生产者与消费者，而这样组可以创建无限个</span>
<span class="token comment">// 每一组的生产者都只会把数据推送给同一组的消费者</span>
<span class="token class-name">MagicianDataProcessing</span><span class="token punctuation">.</span><span class="token function">getProducerAndConsumerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addProducer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DemoProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加一个生产者（可以添加多个）</span>
                <span class="token punctuation">.</span><span class="token function">addConsumer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DemoConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加一个消费者（可以添加多个）</span>
                <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f4fe6fe1.js" defer></script><script src="/assets/js/2.09610e94.js" defer></script><script src="/assets/js/10.fea173a3.js" defer></script>
  </body>
</html>
